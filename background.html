<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <script type="text/javascript">
      /** simple function that draws an icon on a 19x19 canvas */
      var drawIcon = function() {
         var canvas = document.getElementById("icon"),
            ctx = canvas.getContext('2d'),
            bg = ctx.createLinearGradient(0, 0, 0, 20),
            fg = ctx.createLinearGradient(0, 0, 0, 70),
            x = 0, y = 3, h = canvas.height, w = canvas.width, r = 4;
         ctx.clearRect(0,0,canvas.width, canvas.height);
         ctx.font = "bold 10px sans-serif";

         bg.addColorStop(0, "rgba(255,17,120,255)");
         bg.addColorStop(1, "rgba(212,3,69,255)");

         fg.addColorStop(0, "rgba(255,255,255,255)");
         fg.addColorStop(1, "rgba(219,219,219,255)");

         ctx.beginPath();
         ctx.moveTo(x + r, y);
         ctx.lineTo(x + w - r, y);
         ctx.quadraticCurveTo(x + w, y, x + w, y + r);
         ctx.lineTo(x + w, y + h - r);
         ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
         ctx.lineTo(x + r, y + h);
         ctx.quadraticCurveTo(x, y + h, x, y + h - r);
         ctx.lineTo(x, y + r);
         ctx.quadraticCurveTo(x, y, x + r, y);
         ctx.closePath();
         ctx.fillStyle = bg;
         ctx.fill();

         ctx.fillStyle = fg;
         ctx.fillRect(1, h - ((h / 5) * 3), w - 2, (h / 2));

         ctx.fillStyle = "rgba(0,0,0,255)";
         ctx.fillText("m^", 2, h - (h / 5));
         return ctx.getImageData(0, 0, canvas.width, canvas.height);
      };
      /** called when background page is ready */
      var init = function() {
        /* background processing here */
        /* TODO figure out how to use one open socket from all tabs. maybe postMessage...*/
        /*var stream = "ws://stream.meetup.com/2/rsvps", socket = null;
        if(window.WebSocket) {
          var s = new WebSocket(stream);
          s.onmessage = function(e) {
            var rsvp = JSON.parse(e.data);
          };
          s.onopen = function(e)  { alert("socket open"); };
          s.onclose = function(e) { alert("socket closed"); };
          s.onerror = function(e) { alert("socket error " + e); };
        }*/
        /* boiler plate for dynamic icons. most people will use an
           actual image for an icon with the "icons" property of manifest.json
           or the "default_icon" property of "browser_action" */
        chrome.tabs.onCreated.addListener(function(tab) {
          chrome.browserAction.setIcon({imageData:drawIcon(), tabId:tab.id});
        });
        chrome.tabs.onUpdated.addListener(function(tabId, info) {
           //if (info.status === 'loading')
            //console.log('Loading url ... ' + info.url)
        });
        chrome.browserAction.setIcon({imageData:drawIcon()});
      };
    </script>
  </head>
  <body onload="init()">
    <canvas id="icon" width="19" height="19"></canvas>
  </body>
</html>